{% extends 'base.html' %}
{% load staticfiles %}
{% block extraEstilos %}
    <style>
        .lds-hourglass {
  display: inline-block;
  position: relative;
  width: 64px;
  height: 64px;
}
.lds-hourglass:after {
  content: " ";
  display: block;
  border-radius: 50%;
  width: 0;
  height: 0;
  margin: 6px;
  box-sizing: border-box;
  border: 26px solid #fff;
  border-color: dimgrey transparent dimgrey transparent;
  animation: lds-hourglass 1.2s infinite;
}
@keyframes lds-hourglass {
  0% {
    transform: rotate(0);
    animation-timing-function: cubic-bezier(0.55, 0.055, 0.675, 0.19);
  }
  50% {
    transform: rotate(900deg);
    animation-timing-function: cubic-bezier(0.215, 0.61, 0.355, 1);
  }
  100% {
    transform: rotate(1800deg);
  }
}
    </style>
    <link href="/static/css/post.detail.css"  rel="stylesheet"/>
{% endblock %}
{% block inicio %}<a class="navbar-brand" href="#" onclick="return cargarPosts(1,'',true)">ezPosts</a> {% endblock %}
 {% block busquedaForm %}
        <form class="form-inline my-2 my-lg-0">
            <input class="form-control mr-sm-2" id ="buscar" type="search" placeholder="Busqueda" aria-label="Search">
        </form>
       <button class="btn btn-danger my-2 my-sm-0" onclick="buscarPost()">Buscar Post</button>

  {% endblock %}
{% block content %}

    <h1 id="titulo" align="center">Posts Mas recientes</h1>
    <div class="col-sm-12" id="contenido" >
    </div>
    <div class="row">
        <div id="loader"></div>
    </div>
{% endblock %}
{% block js %}
    <script
        src="https://code.jquery.com/jquery-3.3.1.min.js"
        integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8="
        crossorigin="anonymous">
    </script>

<script type="text/javascript">

    let pagina=1;
    let url;
    function inicio(){
        $(document).ready(function() {cargarPosts(1);});
    }
    window.onload=inicio;
    function cargarPosts(pagina,valor='',inicio=false){
        let $contenido = $("#contenido");
        let url;
        if (valor){
            $contenido.empty();
            url = `/post/api/post?titulo=${valor}&page=${pagina}`;
        }else {
            url = `/post/api/post?page=${pagina}`;
        }
        console.log(url);
        $.get(url,
                (data)=> {
                    console.log(data);

                    let html = "";
                    if (data) {
                        data.results.forEach(
                            (post)=>{
                                let cabecera = `<tr><td><h2><strong>${post.titulo}<strong></h2></td></tr>`;
                                let portada_img="https://bitcoinist.com/wp-content/uploads/2018/10/shutterstock_597074750.jpg";
                                if(post.portada){
                                    portada_img=post.portada
                                }
                                let portada = `<tr><td><img src=${portada_img} style='height: 20%; width: 100%; object-fit: contain'/></tr></td>`;
                                let autor = `<tr><td><p>Autor: ${post.autor}<p></td></tr>`;
                                let postdet = `<table>${cabecera + autor+portada}</table>`;
                                //html = html + postdet
                                html = html +generarVista(portada_img, post.titulo, post.autor);
                                console.log(generarVista(portada_img, post.titulo, post.autor));
                            }
                        );



                        if (inicio){
                            $contenido.empty();
                            console.log('se esta en inicio');
                            $contenido.append(html);
                        }else {
                            console.log('se debe estar aqui');
                            $contenido.append(html);
                        }
                    }else {

                    }

                    $('#loader').empty();
                }
        );
    }
    $(window).scroll(function(){
                            var scroll_position_for_post_load = $(window).height() + $(window).scrollTop() + 100;
                            if (scroll_position_for_post_load >= $(document).height()){
                                pagina++;
                                cargarPosts(pagina);
                            }
                             if (scroll_position_for_post_load  > 30) {

                                console.log('deb')
                             }
                            console.log("Esta es la pagina"+pagina);
                        }
    );
    function buscarPost() {
                let valor = document.getElementById('buscar').value;
                cargarPosts(1,valor)
            }
    function generarVista(portada,titulo,autor){
	    let html =`  <div class="blog-card">
                        <div class="meta">
                         <div class="photo" style="background-image: url(${portada})">
                          </div>
                           <ul class="details">
                             <li class="author"><a href="#">${autor}</a></li>
                             <li class="date">Aug. 24, 2015</li>
                            </ul>
                         </div>
                    <div class="description">
                    <h1>${titulo}</h1>
                    <p class="read-more">
                    <a href="#">Leer mas..</a>
                    </p>
                    </div>
                    </div>`;
    return html
}
</script>
{% endblock %}

{% block busquedaPost %}
{% endblock %}